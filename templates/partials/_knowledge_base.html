<aside class="w-1/4 bg-gray-800 border-l border-gray-700 p-4 flex flex-col">
  <h2 class="text-lg font-semibold mb-3">Knowledge Base</h2>

  <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data" class="mb-4">
    <input type="file" name="file" id="fileInput" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4
                  file:rounded-full file:border-0 file:text-sm file:font-semibold
                  file:bg-blue-600 file:text-white hover:file:bg-blue-700 mb-3">
    <button type="submit" id="uploadBtn" disabled
      class="w-full bg-green-600 hover:bg-green-700 py-2 rounded-lg opacity-50 cursor-not-allowed">
      Upload Document
    </button>
  </form>

  <script>
    (function () {
      const fileInput = document.getElementById('fileInput');
      const uploadBtn = document.getElementById('uploadBtn');
      const form = document.getElementById('uploadForm');

      function updateButtonState() {
        const hasFile = fileInput.files && fileInput.files.length > 0;
        uploadBtn.disabled = !hasFile;
        uploadBtn.classList.toggle('opacity-50', !hasFile);
        uploadBtn.classList.toggle('cursor-not-allowed', !hasFile);
      }

      fileInput.addEventListener('change', updateButtonState);

      // safety: prevent accidental submit if no file selected
      form.addEventListener('submit', function (e) {
        if (!fileInput.files || fileInput.files.length === 0) {
          e.preventDefault();
        }
      });
    })();
  </script>

  <script>
    async function deleteFile(filename) {
      if (!confirm(`Are you sure you want to delete "${filename}"?`)) return;

      try {
        const res = await fetch(`/delete/${filename}`, {
          method: 'DELETE'
        });
        const data = await res.json();
        if (data.status === 'deleted') {
          // Remove the file row dynamically
          const fileDiv = document.getElementById(`file-${filename}`);
          if (fileDiv) fileDiv.remove();
        } else {
          alert(`Error: File not found.`);
        }
      } catch (err) {
        alert('Error deleting file.');
        console.error(err);
      }
    }
  </script>

  <div id="docList" class="overflow-y-auto flex-1 space-y-2">
    {% for doc in documents %}
    <div
      class="flex justify-between items-center p-3 bg-gray-800 rounded-lg mb-2 shadow-sm hover:bg-gray-700 transition-colors duration-200"
      id="file-{{ doc }}">
      <span class="text-sm text-gray-200 truncate">{{ doc }}</span>
      <div class="flex space-x-3">
        <a href="/download/{{ doc }}" class="text-blue-400 hover:text-blue-500 text-sm font-medium">
          Download
        </a>
        <button onclick="deleteFile('{{ doc }}')" class="text-red-400 hover:text-red-500 text-sm font-medium">
          Delete
        </button>
      </div>
    </div>

  </div>

  {% else %}
  <p class="text-sm text-gray-400">No documents uploaded yet.</p>
  {% endfor %}
  </div>
</aside>